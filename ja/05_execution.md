# 5. CI/CD とローカル実行の役割分担

コード品質を担保しつつ、開発効率を最大化するためには、機械的・自動的に実施する項目と、開発者の判断・作業によって実施する項目を明確に区別する必要がある。

以下に、役割分担を行う理由を示す。

- **すべての検証を CI/CD に組み込むと、実行時間が長くなり、開発速度の低下につながる**
- **ローカルで実行可能な項目は、開発者が自身のタイミングで実施することで効率化できる**
- **フォーマットや Lint などは、IDE（例：VSCode）やプラグインによる自動実行が可能であり、開発フローへ自然に組み込むことで CI/CD への過度な依存を回避できる**

このような設計により、CI/CD ではプロジェクト全体の品質チェックを機械的に担保し、開発者は設計・仕様・影響範囲など、思考を要する項目に集中できる運用とする。

---

### ✅ CI/CD（gitlab-ci）で実行すべきもの

| 項目                       | ツール                 | 理由・効果                                                       |
| -------------------------- | ---------------------- | ---------------------------------------------------------------- |
| 静的解析（型・設計）       | PHPStan（Larastan）    | 型ミス・設計漏れの早期検知。CI で全体をチェックし、品質担保      |
| 静的解析（セキュリティ）   | Psalm / Composer Audit | 依存ライブラリの脆弱性含めて機械検出可能                         |
| ユニットテスト・カバレッジ | PHPUnit                | 品質担保の基盤として必須。継続的に品質を維持するために CI で実行 |

### ✅ ローカル実行（開発時に開発者が実行すべきもの）

#### 🔹 開発者が実行するもの（開発フロー内に組み込み）

| 項目                           | ツール                           | 理由・効果                                                           |
| ------------------------------ | -------------------------------- | -------------------------------------------------------------------- |
| コーディング規約・フォーマット | Laravel Pint / VSCode プラグイン | 保存時自動フォーマットでコーディング規約遵守。IDE で対応し開発効率化 |

#### 🔹 開発者・レビュー担当者が実行・確認するもの

| 項目            | ツール                         | 理由・効果                                                   |
| --------------- | ------------------------------ | ------------------------------------------------------------ |
| N+1 検知        | Laravel Telescope / Debugbar   | 実行時でないと検知困難なため、開発・レビュータイミングで確認 |
| AI 補助レビュー | ChatGPT / Copilot / LLM ツール | 仕様漏れ・設計ミスの指摘補助（開発・レビュー時活用）         |
| E2E テスト      | Laravel Dusk / Cypress         | 本番相当環境が必要なため、必要時実行。レビュー時にも活用可能 |
